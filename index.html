<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FuggaFod Signup/Login</title>
<!-- Firebase JS SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
  body { 
    background: linear-gradient(to bottom right, #6a11cb, #2575fc);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-family: sans-serif;
    color: #fff;
  }
  .signup-card {
    background: rgba(0,0,0,0.7);
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
    width: 90%;
    max-width: 400px;
    text-align: center;
  }
  .signup-card input {
    width: 100%;
    padding: 12px;
    margin: 10px 0;
    border-radius: 8px;
    border: none;
    outline: none;
  }
  .signup-card button {
    width: 100%;
    padding: 12px;
    background: #ff4b2b;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: 0.3s;
    color: #fff;
    margin-top: 10px;
  }
  .signup-card button:hover {
    background: #ff416c;
  }
  .toggle-text {
    color: #00ffff;
    cursor: pointer;
    margin-top: 15px;
    font-size: 0.9em;
    text-decoration: underline;
    display: inline-block;
  }
  .error-msg { color: #ffcccb; font-size: 0.9em; }
</style>
</head>
<body>

<div class="signup-card">
  <h2>FuggaFod Signup</h2>
  
  <!-- Signup Form -->
  <form id="signupForm">
    <input type="text" id="username" placeholder="Username" required><br>
    <input type="email" id="email" placeholder="Email" required><br>
    <input type="password" id="password" placeholder="Password" required><br>
    <div class="error-msg" id="errorMsg"></div>
    <button type="submit">Sign Up</button>
  </form>
  
  <!-- Toggle Text to Login -->
  <div class="toggle-text" id="showLoginBtn">Already have an account? Login</div>
  
  <!-- Login Form (hidden by default) -->
  <form id="loginForm" style="display:none; margin-top:15px;">
    <input type="email" id="loginEmail" placeholder="Email" required><br>
    <input type="password" id="loginPassword" placeholder="Password" required><br>
    <div class="error-msg" id="loginErrorMsg"></div>
    <button type="submit">Login</button>
  </form>
</div>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDSeRdpupEQcEwo_q54umdAU4WHeCoPTGs",
    authDomain: "ff-game-login.firebaseapp.com",
    databaseURL: "https://ff-game-login-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "ff-game-login",
    storageBucket: "ff-game-login.firebasestorage.app",
    messagingSenderId: "318341155193",
    appId: "1:318341155193:web:d56d80dd691568b2cfc7a8",
    measurementId: "G-0H5SM37VLZ"
  };
  firebase.initializeApp(firebaseConfig);

  function validatePassword(password) {
    const re = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{6,}$/;
    return re.test(password);
  }

  const signupForm = document.getElementById('signupForm');
  const loginForm = document.getElementById('loginForm');
  const showLoginBtn = document.getElementById('showLoginBtn');
  const errorMsg = document.getElementById('errorMsg');
  const loginErrorMsg = document.getElementById('loginErrorMsg');

  // Toggle to show login form
  showLoginBtn.addEventListener('click', () => {
    signupForm.style.display = 'none';
    showLoginBtn.style.display = 'none';
    loginForm.style.display = 'block';
    document.querySelector('h2').textContent = 'FuggaFod Login';
  });

  // SIGNUP
  signupForm.addEventListener('submit', function(e){
    e.preventDefault();
    const username = document.getElementById('username').value.trim();
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();
    errorMsg.textContent = '';

    if(!validatePassword(password)){
      errorMsg.textContent = 'Password must contain 1 uppercase, 1 lowercase, 1 number, 1 symbol';
      return;
    }

    const userId = Date.now();
    firebase.database().ref('users/' + userId).set({
      username: username,
      email: email,
      signupTime: new Date().toISOString(),
      tokens: 1000,
      password: password
    }).then(() => {
      localStorage.setItem('username', username);
      localStorage.setItem('userId', userId);
      window.location.href = 'dashboard.html';
    }).catch((error) => {
      console.error('Firebase error:', error);
      errorMsg.textContent = error.message;
    });
  });

  // LOGIN
  loginForm.addEventListener('submit', function(e){
    e.preventDefault();
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value.trim();
    loginErrorMsg.textContent = '';

    firebase.database().ref('users').orderByChild('email').equalTo(email).once('value')
    .then(snapshot => {
      if(snapshot.exists()){
        let userId = Object.keys(snapshot.val())[0];
        let userData = snapshot.val()[userId];
        if(userData.password === password){
          localStorage.setItem('userId', userId);
          localStorage.setItem('username', userData.username);
          window.location.href = 'dashboard.html';
        } else {
          loginErrorMsg.textContent = 'Incorrect password';
        }
      } else {
        loginErrorMsg.textContent = 'Email not registered';
      }
    }).catch(err => {
      console.error(err);
      loginErrorMsg.textContent = err.message;
    });
  });
</script>

</body>
</html>
